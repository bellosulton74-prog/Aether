<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AETHER - Admin Panel</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=MedievalSharp&display=swap');
    
    :root {
      --bg-color: #f8f3e6;
      --card-bg: #ffffff;
      --text: #5a4c3e;
      --button-bg: #e1ab55;
      --button-hover: #d19c46;
      --border: #d4b87a;
      --accent: #8b7355;
      --header-bg: #8b7355;
      --header-text: #f8f3e6;
      --row-even: #fefcf7;
      --row-odd: #f5f0e6;
    }

    body {
      background-color: var(--bg-color);
      font-family: 'Cinzel', serif;
      margin: 0;
      padding: 20px;
      color: var(--text);
      background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" opacity="0.05"><path d="M20,20 L80,20 L80,80 L20,80 Z" fill="none" stroke="%238b7355" stroke-width="2"/><path d="M30,30 L70,30 L70,70 L30,70 Z" fill="none" stroke="%238b7355" stroke-width="1"/></svg>');
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    header {
      text-align: center;
      margin-bottom: 30px;
      padding: 20px;
      border-bottom: 2px solid var(--border);
    }

    h1 {
      color: var(--accent);
      font-size: 2.5rem;
      margin: 0;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
    }

    .subtitle {
      font-style: italic;
      margin-top: 5px;
      color: var(--text);
    }

    .stats {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin: 20px 0;
      flex-wrap: wrap;
    }

    .stat-card {
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 15px 25px;
      text-align: center;
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
      min-width: 150px;
    }

    .stat-number {
      font-size: 2rem;
      font-weight: bold;
      color: var(--accent);
      display: block;
    }

    .stat-label {
      font-size: 0.9rem;
      color: var(--text);
    }

    .controls {
      display: flex;
      justify-content: space-between;
      margin-bottom: 20px;
      flex-wrap: wrap;
      gap: 10px;
    }

    button {
      font-family: 'Cinzel', serif;
      font-size: 14px;
      padding: 8px 16px;
      border-radius: 4px;
      border: none;
      color: #5a4c3e;
      background-color: var(--button-bg);
      cursor: pointer;
      transition: all 0.25s ease;
      font-weight: 600;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.15);
    }

    button:hover {
      background-color: var(--button-hover);
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }

    .button-secondary {
      background-color: #d7c9b5;
    }

    .button-secondary:hover {
      background-color: #c8b9a3;
    }

    .search-box {
      flex-grow: 1;
      max-width: 300px;
    }

    input {
      font-family: 'MedievalSharp', cursive;
      font-size: 14px;
      padding: 8px 12px;
      border-radius: 4px;
      border: 1px solid var(--border);
      width: 100%;
      outline: none;
      background-color: #fefcf7;
      color: var(--text);
      box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    input::placeholder {
      color: #a89b8a;
    }

    .table-container {
      background: var(--card-bg);
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      margin-bottom: 30px;
      overflow-x: auto;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    th {
      background-color: var(--header-bg);
      color: var(--header-text);
      padding: 15px 10px;
      text-align: left;
      font-weight: 700;
      position: sticky;
      top: 0;
    }

    td {
      padding: 12px 10px;
      border-bottom: 1px solid #eae2d6;
    }

    tr:nth-child(even) {
      background-color: var(--row-even);
    }

    tr:nth-child(odd) {
      background-color: var(--row-odd);
    }

    tr:hover {
      background-color: #f0e9dd;
    }

    .username-cell {
      font-weight: 600;
    }

    .address-cell {
      font-family: monospace;
      font-size: 0.85rem;
      max-width: 200px;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .link-cell a {
      color: var(--accent);
      text-decoration: none;
      word-break: break-all;
    }

    .link-cell a:hover {
      text-decoration: underline;
    }

    .timestamp-cell {
      font-size: 0.85rem;
      color: #7a6d5a;
    }

    .empty-state {
      text-align: center;
      padding: 40px;
      color: #7a6d5a;
    }

    .loading {
      text-align: center;
      padding: 40px;
    }

    .spinner {
      border: 4px solid #f3f3f3;
      border-top: 4px solid var(--button-bg);
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 0 auto 15px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .export-section {
      background: var(--card-bg);
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
      margin-bottom: 30px;
    }

    .export-options {
      display: flex;
      gap: 10px;
      margin-top: 10px;
      flex-wrap: wrap;
    }

    footer {
      text-align: center;
      margin-top: 30px;
      padding: 20px;
      color: #7a6d5a;
      font-size: 0.9rem;
      border-top: 1px solid var(--border);
    }

    @media (max-width: 768px) {
      .controls {
        flex-direction: column;
      }
      
      .search-box {
        max-width: 100%;
      }
      
      th, td {
        padding: 8px 5px;
        font-size: 0.85rem;
      }
      
      .address-cell {
        max-width: 120px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>AETHER Admin Panel</h1>
      <p class="subtitle">View all user submissions and wallet addresses</p>
      
      <div class="stats">
        <div class="stat-card">
          <span class="stat-number" id="totalEntries">0</span>
          <span class="stat-label">Total Entries</span>
        </div>
        <div class="stat-card">
          <span class="stat-number" id="todayEntries">0</span>
          <span class="stat-label">Today's Entries</span>
        </div>
        <div class="stat-card">
          <span class="stat-number" id="uniqueUsers">0</span>
          <span class="stat-label">Unique Users</span>
        </div>
      </div>
    </header>

    <div class="controls">
      <div class="search-box">
        <input type="text" id="searchInput" placeholder="Search by username, address, or date...">
      </div>
      <div>
        <button id="refreshBtn">Refresh Data</button>
        <button class="button-secondary" id="clearSearchBtn">Clear Search</button>
      </div>
    </div>

    <div class="export-section">
      <h3>Export Data</h3>
      <p>Download the submission data in various formats:</p>
      <div class="export-options">
        <button id="exportCSV">Export as CSV</button>
        <button id="exportJSON">Export as JSON</button>
        <button id="exportAddresses">Export Addresses Only</button>
      </div>
    </div>

    <div class="table-container">
      <table id="entriesTable">
        <thead>
          <tr>
            <th>Timestamp</th>
            <th>X Username</th>
            <th>Solana Address</th>
            <th>Repost Link</th>
            <th>Comment Link</th>
          </tr>
        </thead>
        <tbody id="entriesBody">
          <tr>
            <td colspan="5" class="loading">
              <div class="spinner"></div>
              <p>Loading entries from the sacred scrolls...</p>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <footer>
      <p>AETHER Admin Panel &copy; 2023 | Redefining How NFTs are Launched</p>
    </footer>
  </div>

  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
    import { getDatabase, ref, onValue, off } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-database.js";

    // Firebase configuration (same as your main app)
    const firebaseConfig = {
      apiKey: "AIzaSyCw3iYwkzeaZLY7AKdF53i1-GBIHFEisug",
      authDomain: "aethers-18282.firebaseapp.com",
      databaseURL: "https://aethers-18282-default-rtdb.firebaseio.com",
      projectId: "aethers-18282",
      storageBucket: "aethers-18282.firebasestorage.app",
      messagingSenderId: "25703092957",
      appId: "1:25703092957:web:b431273488fe8e4f018134"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const entriesRef = ref(db, "entries");

    // DOM elements
    const entriesBody = document.getElementById('entriesBody');
    const totalEntriesEl = document.getElementById('totalEntries');
    const todayEntriesEl = document.getElementById('todayEntries');
    const uniqueUsersEl = document.getElementById('uniqueUsers');
    const searchInput = document.getElementById('searchInput');
    const refreshBtn = document.getElementById('refreshBtn');
    const clearSearchBtn = document.getElementById('clearSearchBtn');
    const exportCSVBtn = document.getElementById('exportCSV');
    const exportJSONBtn = document.getElementById('exportJSON');
    const exportAddressesBtn = document.getElementById('exportAddresses');

    let allEntries = [];
    let filteredEntries = [];

    // Load data from Firebase
    function loadData() {
      entriesBody.innerHTML = `
        <tr>
          <td colspan="5" class="loading">
            <div class="spinner"></div>
            <p>Loading entries from the sacred scrolls...</p>
          </td>
        </tr>
      `;

      onValue(entriesRef, (snapshot) => {
        allEntries = [];
        const data = snapshot.val();
        
        if (data) {
          // Convert object to array
          Object.keys(data).forEach(key => {
            allEntries.push({
              id: key,
              ...data[key]
            });
          });
          
          // Sort by timestamp (newest first)
          allEntries.sort((a, b) => {
            const timeA = a.timestamp ? new Date(a.timestamp) : new Date(0);
            const timeB = b.timestamp ? new Date(b.timestamp) : new Date(0);
            return timeB - timeA;
          });
        }
        
        updateStats();
        filterEntries();
      }, (error) => {
        console.error("Error loading data:", error);
        entriesBody.innerHTML = `
          <tr>
            <td colspan="5" class="empty-state">
              <p>Failed to load data from the sacred scrolls.</p>
              <p>Error: ${error.message}</p>
            </td>
          </tr>
        `;
      });
    }

    // Update statistics
    function updateStats() {
      totalEntriesEl.textContent = allEntries.length;
      
      // Calculate today's entries
      const today = new Date().toDateString();
      const todayCount = allEntries.filter(entry => {
        if (!entry.timestamp) return false;
        const entryDate = new Date(entry.timestamp).toDateString();
        return entryDate === today;
      }).length;
      todayEntriesEl.textContent = todayCount;
      
      // Calculate unique users
      const uniqueUsernames = new Set(allEntries.map(entry => entry.username));
      uniqueUsersEl.textContent = uniqueUsernames.size;
    }

    // Filter entries based on search
    function filterEntries() {
      const searchTerm = searchInput.value.toLowerCase();
      
      if (!searchTerm) {
        filteredEntries = [...allEntries];
      } else {
        filteredEntries = allEntries.filter(entry => {
          return (
            (entry.username && entry.username.toLowerCase().includes(searchTerm)) ||
            (entry.address && entry.address.toLowerCase().includes(searchTerm)) ||
            (entry.timestamp && new Date(entry.timestamp).toLocaleString().toLowerCase().includes(searchTerm))
          );
        });
      }
      
      renderEntries();
    }

    // Render entries to the table
    function renderEntries() {
      if (filteredEntries.length === 0) {
        entriesBody.innerHTML = `
          <tr>
            <td colspan="5" class="empty-state">
              <p>No entries found in the sacred scrolls.</p>
              ${searchInput.value ? '<p>Try adjusting your search terms.</p>' : ''}
            </td>
          </tr>
        `;
        return;
      }
      
      entriesBody.innerHTML = filteredEntries.map(entry => `
        <tr>
          <td class="timestamp-cell">
            ${entry.timestamp ? new Date(entry.timestamp).toLocaleString() : 'Unknown'}
          </td>
          <td class="username-cell">${entry.username || 'N/A'}</td>
          <td class="address-cell" title="${entry.address || ''}">${entry.address || 'N/A'}</td>
          <td class="link-cell">
            ${entry.repostLink ? 
              `<a href="${entry.repostLink}" target="_blank" rel="noopener">View Repost</a>` : 
              'N/A'}
          </td>
          <td class="link-cell">
            ${entry.commentLink ? 
              `<a href="${entry.commentLink}" target="_blank" rel="noopener">View Comment</a>` : 
              'N/A'}
          </td>
        </tr>
      `).join('');
    }

    // Export functions
    function exportToCSV() {
      if (filteredEntries.length === 0) {
        alert("No data to export.");
        return;
      }
      
      const headers = ['Timestamp', 'Username', 'Solana Address', 'Repost Link', 'Comment Link'];
      const csvContent = [
        headers.join(','),
        ...filteredEntries.map(entry => [
          entry.timestamp ? new Date(entry.timestamp).toLocaleString() : '',
          `"${(entry.username || '').replace(/"/g, '""')}"`,
          `"${(entry.address || '').replace(/"/g, '""')}"`,
          `"${(entry.repostLink || '').replace(/"/g, '""')}"`,
          `"${(entry.commentLink || '').replace(/"/g, '""')}"`
        ].join(','))
      ].join('\n');
      
      downloadFile(csvContent, 'aether-entries.csv', 'text/csv');
    }

    function exportToJSON() {
      if (filteredEntries.length === 0) {
        alert("No data to export.");
        return;
      }
      
      const jsonContent = JSON.stringify(filteredEntries, null, 2);
      downloadFile(jsonContent, 'aether-entries.json', 'application/json');
    }

    function exportAddressesOnly() {
      if (filteredEntries.length === 0) {
        alert("No data to export.");
        return;
      }
      
      const addresses = filteredEntries
        .filter(entry => entry.address)
        .map(entry => entry.address)
        .join('\n');
      
      downloadFile(addresses, 'aether-addresses.txt', 'text/plain');
    }

    function downloadFile(content, fileName, contentType) {
      const blob = new Blob([content], { type: contentType });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = fileName;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    // Event listeners
    searchInput.addEventListener('input', filterEntries);
    refreshBtn.addEventListener('click', loadData);
    clearSearchBtn.addEventListener('click', () => {
      searchInput.value = '';
      filterEntries();
    });
    exportCSVBtn.addEventListener('click', exportToCSV);
    exportJSONBtn.addEventListener('click', exportToJSON);
    exportAddressesBtn.addEventListener('click', exportAddressesOnly);

    // Initialize
    loadData();
  </script>
</body>
</html>